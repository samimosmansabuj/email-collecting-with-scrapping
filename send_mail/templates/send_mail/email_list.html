{% extends "base.html" %}
{% block site_title %}
<title>Fiverr Email Scrapping List - PyTeam</title>
{% endblock site_title %}
{% block content %}
<style>
    .btn {
        display: inline-block;
        padding: 8px 14px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: bold;
        transition: background 0.3s, transform 0.2s;
    }

    .btn-primary {
        background: #243447;
        color: #fff;
    }

    .btn-primary:hover {
        background: #1a2530;
        transform: translateY(-1px);
    }

    h2 {
        margin-top: 0;
        color: #243447;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
    }

    th {
        background: #243447;
        color: #fff;
        padding: 12px 10px;
        text-align: left;
        font-size: 14px;
    }

    td {
        padding: 10px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }

    tr:nth-child(even) {
        background: #f9f9f9;
    }

    tr:hover {
        background: #f1f7ff;
    }

    .no-data {
        text-align: center;
        padding: 20px;
        font-style: italic;
        color: #666;
    }

    .filter-bar {
        position: sticky;
        top: 0;
        background: #fff;
        z-index: 5;
        padding: 12px;
        border: 1px solid #eee;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, .04);
    }

    .filter-bar label {
        display: block;
        margin-bottom: 4px;
    }
</style>

<!-- <h2 id="total_count">Total Collection Email: {{ count }}</h2> -->
 <!-- Header / status -->
<h2 id="total_count">
  {% if has_filters %}
    Showing {{ count }} filtered result{{ count|pluralize }} 
    <small style="font-weight:normal;">(<a href=".">clear filters</a>)</small>
  {% else %}
    Total Collection Email: {{ count }}
  {% endif %}
</h2>


<!-- Include Filter Data  -->
<form method="get" class="filter-bar"
    style="margin:16px 0; display:grid; gap:10px; grid-template-columns: repeat(6, minmax(140px, 1fr)); align-items:end">
    <div>
        <label for="q" style="font-size:12px;color:#243447;">Search</label>
        <input id="q" name="q" value="{{ request.GET.q }}" placeholder="email / review"
            style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;">
    </div>

    <div>
        <label for="country" style="font-size:12px;color:#243447;">Country</label>
        <select id="country" name="country" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;">
            <option value="">All</option>
            {% for c in countries %}
            <option value="{{ c }}" {% if request.GET.country == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label for="proficiency" style="font-size:12px;color:#243447;">Proficiency</label>
        <select id="proficiency" name="proficiency"
            style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;">
            <option value="">All</option>
            {% for pr in proficiencies %}
            <option value="{{ pr }}" {% if request.GET.proficiency == pr %}selected{% endif %}>{{ pr }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label for="category" style="font-size:12px;color:#243447;">Category</label>
        <select id="category" name="category" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;">
            <option value="">All</option>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if request.GET.category == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label for="sub_category" style="font-size:12px;color:#243447;">Sub-category</label>
        <select id="sub_category" name="sub_category"
            style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;">
            <option value="">All</option>
            {% for sub in sub_categories %}
            <option value="{{ sub }}" {% if request.GET.sub_category == sub %}selected{% endif %}>{{ sub }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label for="repeated" style="font-size:12px;color:#243447;">Repeated</label>
        <select id="repeated" name="repeated" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;">
            <option value="">All</option>
            <option value="1" {% if request.GET.repeated == '1' %}selected{% endif %}>Yes</option>
            <option value="0" {% if request.GET.repeated == '0' %}selected{% endif %}>No</option>
        </select>
    </div>

    <div style="grid-column: span 2 / auto; display:flex; gap:8px;">
        <button type="submit" class="btn btn-primary">Apply Filters</button>
        <a href="." class="btn" style="border:1px solid #ddd;">Reset</a>
    </div>
</form>

<table>
    <tr>
        <th>No.</th>
        <th>Email</th>
        <th>Repeated</th>
        <th>Country</th>
        <th>Price Tag</th>
        <th>Proficiency</th>
        <th>Category</th>
        <th>Sub-category</th>
        <th>Review Description</th>
    </tr>
    <!-- {% for data in data_list %}
    <tr>
        <td>{{ forloop.counter|stringformat:"02d" }}</td>
        <td>{{ data.email }}</td>
        <td>{{ data.repeated }}</td>
        <td>{{ data.country }}</td>
        <td>{{ data.price_tag }}</td>
        <td>{{ data.proficiency }}</td>
        <td>{{ data.category }}</td>
        <td>{{ data.sub_category }}</td>
        <td>{{ data.review_description|truncatechars:80 }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="9" class="no-data">No data available.</td>
    </tr>
    {% endfor %} -->
    {% for data in data_list %}
        <tr>
        <td>{{ forloop.counter|stringformat:"02d" }}</td>
        <td>{{ data.email }}</td>
        <td>{{ data.repeated }}</td>
        <td>{{ data.country }}</td>
        <td>{{ data.price_tag }}</td>
        <td>{{ data.proficiency }}</td>
        <td>{{ data.category }}</td>
        <td>{{ data.sub_category }}</td>
        <td>{{ data.review_description|truncatechars:80 }}</td>
        </tr>
    {% empty %}
        <tr>
        <td colspan="9" class="no-data">
            {% if has_filters %}No matches for the selected filters.{% else %}No data available.{% endif %}
        </td>
        </tr>
    {% endfor %}
</table>


<script>
document.addEventListener("DOMContentLoaded", function(){
    const form = document.getElementById("emailForm");

    // Result Box =========
    

    // Form Data==============
    const submitButton = form.querySelector("button[type='submit']");

    form.addEventListener("submit", async function(event) {
        event.preventDefault();
        const formData = new FormData(form);
        
        try {
            const response = await fetch("{% url '' %}", {
                method: "POST",
                body: formData,
                headers: {
                    "X-Requested-With": "XMLHttpRequest"
                },
            });
            const data = await response.json();
            if (data.status === true || data.status === "verified") {
                statusIcon.textContent = "✅";
                statusTitle.textContent = "Verified";
                statusMsg.textContent = data.message || "The email is valid and verified.";
                resultBox.style.color = "green";
            } else {
                statusIcon.textContent = "❌";
                statusTitle.textContent = "Unverified";
                statusMsg.textContent = data.message || "The email is invalid or not verified.";
                resultBox.style.color = "red";
            }

        } catch (error) {
            statusIcon.textContent = "⚠️";
            statusTitle.textContent = "Error";
            statusMsg.textContent = "Something went wrong while checking the email.";
            resultBox.style.color = "orange";
            console.error(error);
        } finally {
          emailInput.disabled = false;
          submitButton.disabled = false;
        }
    });
});
</script>



{% endblock %}