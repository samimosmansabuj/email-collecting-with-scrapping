{% extends "base.html" %}
{% block content %}
<style>
  form {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    max-width: 600px;
    margin: auto;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }

  label {
    display: block;
    margin-top: 12px;
    font-weight: bold;
  }

  select,
  input,
  textarea {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  button {
    margin-top: 16px;
    padding: 10px 16px;
    background: #243447;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  button:hover {
    background: #1a2530;
  }
</style>



<form method="post">
  {% csrf_token %}
  <h2>Add Target</h2>

  <label for="category">Category</label>
  <select id="category" name="category" required>
    <option value="">-- Select Category --</option>
    {% for caregory in caregory %}
    <option value="{{caregory.slug}}">{{caregory.name}}</option>
    {% endfor %}
  </select>

  <label for="subcategory">Sub-category</label>
  <select id="subcategory" name="subcategory" required disabled>
    <option value="">-- Select Sub-category --</option>
  </select>

  <label for="urltype">URL Type</label>
  <select id="urltype" name="urltype" required>
    <option value="">-- Select Sub-category --</option>
    <option value="profile">Profile</option>
    <option value="gig">Gig</option>
  </select>

  <label for="username">Username</label>
  <input type="text" id="username" name="username" placeholder="Enter username" required>

  <label for="url">URL</label>
  <input type="url" id="url" name="url" placeholder="https://fiverr.com/username/gig-slug/" required>

  <label for="total_reviews">Total Reviews</label>
  <input type="number" id="total_reviews" name="total_reviews" placeholder="Enter total reviews" required>

  <label for="html_code">HTML Code</label>
  <textarea id="html_code" name="html_code" rows="8" placeholder="Paste raw HTML code here..."></textarea>

  <button type="submit">Submit</button>
</form>

<script>
  const categoryEl = document.getElementById('category');
  const subcatEl   = document.getElementById('subcategory');

  function resetSubcats(placeholder='-- Select Sub-category --', disable=true) {
    subcatEl.innerHTML = `<option value="">${placeholder}</option>`;
    subcatEl.disabled = disable;
  }

  categoryEl.addEventListener('change', async (e) => {
    const slug = e.target.value;
    if (!slug) { resetSubcats(); return; }

    resetSubcats('Loading...', true);

    try {
      const res = await fetch(`/api/subcategories/${encodeURIComponent(slug)}/`, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
      });
      const data = await res.json();

      if (!data.ok) { resetSubcats('No sub-categories found', true); return; }

      resetSubcats('-- Select Sub-category --', false);
      data.results.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.slug;   // will post the slug
        opt.textContent = s.name;
        subcatEl.appendChild(opt);
      });

      if (data.results.length === 0) resetSubcats('No sub-categories', true);
    } catch (err) {
      console.error('Subcategory fetch error:', err);
      resetSubcats('Failed to load', true);
    }
  });
</script>
{% endblock %}